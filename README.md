Проект по бронированию отелей

Многомодульное распределённое приложение на Spring Boot и Spring Cloud

Архитектура включает следующие компоненты:

API Gateway — реализован с использованием Spring Cloud Gateway и служит единой точкой входа для клиентских запросов.
Booking Service — отвечает за управление бронированиями, обеспечивает аутентификацию пользователей через JWT и поддерживает согласованность данных без применения глобальных распределённых транзакций.
Hotel Management Service — предоставляет CRUD-операции для управления отелями и номерами, а также рассчитывает агрегированные метрики загруженности.
Eureka Server — выступает в роли Service Registry, обеспечивая динамическое обнаружение и регистрацию сервисов.
Все сервисы используют встроенную базу данных H2 для хранения данных. Взаимодействие между сервисами организовано как последовательность локальных транзакций, что исключает необходимость в глобальных распределённых транзакциях и способствует повышению отказоустойчивости системы.


Основные возможности:

Аутентификация и управление пользователями;

Регистрация и вход пользователей через Booking Service с использованием JWT. Администраторы могут управлять пользователями (CRUD).
Управление бронированиями;

Поддержка двухэтапного процесса бронирования: статус PENDING → CONFIRMED / CANCELLED. В случае отмены применяется механизм компенсации для поддержания согласованности данных.
Идемпотентность и надёжность вызовов;

Все изменяющие состояние запросы поддерживают идемпотентность через уникальный requestId.;

Удалённые вызовы между сервисами защищены таймаутами, повторными попытками с экспоненциальной задержкой и корректной обработкой ошибок.
Рекомендации при выборе номера;

Номера предлагаются с учётом популярности: сортировка по убыванию количества бронирований (timesBooked), при равенстве — по возрастанию id.;

Администрирование каталога;

Администраторы могут управлять отелями и номерами (CRUD-операции).;

Аналитические агрегаты;

Сбор и отображение метрик популярности номеров на основе поля timesBooked.;

Сквозная трассировка;

Поддержка сквозной корреляции запросов через HTTP-заголовок X-Correlation-Id для упрощения диагностики и логирования.

Предварительные требования
Java 17 или выше;

Maven 3.9 или выше

Сборка и запуск:

Для запуска приложения выполните следующие шаги (каждый сервис — в отдельном терминале):

1. Запустите Eureka Server (реестр сервисов): mvn -pl eureka-server spring-boot:run
2. Запустите API Gateway: mvn -pl api-gateway spring-boot:run
3. Запустите сервисы бизнес-логики: Hotel Management Service - mvn -pl hotel-service spring-boot:run, Booking Service - mvn -pl booking-service spring-boot:run


Конфигурация JWT:

Для демонстрационных целей используется симметричный алгоритм подписи HMAC. Секретный ключ задаётся через свойство:
security:
  jwt:
    secret: dev-secret-please-change


Это значение по умолчанию указано в файлах конфигурации следующих модулей:

api-gateway/src/main/resources/application.yml;

hotel-service/src/main/resources/application.yml;

booking-service/src/main/resources/application.yml;

Важно: Для использования в production-среде обязательно замените секрет на надёжный и, по возможности, перейдите на централизованное управление аутентификацией через OAuth2-провайдер (например, Keycloak или Auth0). 




Тестирование:

Примеры ключевых тестов

Hotel Service
HotelAvailabilityTests — проверка идемпотентности операций hold / confirm / release;

HotelMoreTests — валидация логики занятости номеров по датам, корректности флага available и расчёта статистики (timesBooked);

HotelHttpIT#adminCanCreateHotel — интеграционный тест через MockMvc: подтверждение, что администратор может создавать отели;

Booking Service
Интеграционные тесты реализованы с использованием WebTestClient и WireMock:
BookingHttpIT#createBooking_Http_Success — успешный сценарий создания бронирования со статусом CONFIRMED;

Покрыты следующие критические сценарии:
Обработка ошибок удалённых вызовов (включая механизм компенсации);

Таймауты при взаимодействии с другими сервисами;

Идемпотентность запросов;

Логика формирования подсказок при выборе номера;

Запуск тестов:

Для выполнения всех тестов используйте команду:
mvn -q -DskipTests=false test
